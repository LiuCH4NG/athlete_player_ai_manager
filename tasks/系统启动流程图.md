# 系统启动流程图

```mermaid
graph TD
    A[启动 main.py] --> B[读取环境变量PORT<br/>默认8001]
    B --> C[启动 uvicorn 服务器<br/>host=0.0.0.0:8001]
    C --> D[加载 app.main:app]
    D --> E[创建 FastAPI 应用实例<br/>初始化 lifespan]
    E --> F[执行 lifespan startup:<br/>init_db 初始化数据库]
    F --> G[创建数据库引擎<br/>SQLite athlete.db]
    G --> H[执行 models.Base.metadata.create_all<br/>创建所有表结构]
    H --> I[注册依赖注入<br/>get_db AsyncSession]
    I --> J[挂载 MCP 服务<br/>FastApiMCP mount_http]
    J --> K[挂载静态文件<br>/frontend -> StaticFiles]
    K --> L[注册 API 路由:<br/>• /athletes CRUD<br/>• /athletes/search 搜索<br/>• /chat AI聊天<br/>• / MCP工具]
    L --> M[注册前端页面路由<br>/ -> index.html]
    M --> N[服务器就绪<br/>监听 0.0.0.0:8001]
```

### 启动顺序说明

1. **入口点**: `main.py` 启动 uvicorn ASGI 服务器
2. **应用初始化**: 加载 `app.main:app` FastAPI 应用
3. **数据库初始化**: 创建 SQLite 连接，执行 ORM 模型创建
4. **MCP 服务**: 挂载 Model Context Protocol 服务（端口8001的/mcp端点）
5. **路由注册**: 注册运动员CRUD、搜索、AI聊天等接口
6. **静态资源**: 挂载前端静态文件目录

### 关键配置
- 端口: 8001（可配置）
- 数据库: SQLite (sqlite+aiosqlite:///./athlete.db)
- 静态目录: frontend/
- MCP端点: http://localhost:8001/mcp/
